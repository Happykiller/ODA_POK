!function(){"use strict";$.Oda.App={version:"0.1",startApp:function(p_params){try{return $.Oda.Router.addRoute("home",{path:"partials/home.html",title:"oda-main.home-title",urls:["","home"],middleWares:["support","auth"],dependencies:["dataTables"]}),$.Oda.Router.addRoute("newContest",{path:"partials/newContest.html",title:"newContest.title",urls:["creer_tournoi"],middleWares:["support","auth"],dependencies:["dataTables"]}),$.Oda.Router.addRoute("detailsContest",{path:"partials/detailsContest.html",title:"detailsContest.title",urls:["tournoi_param"],middleWares:["support","auth"],dependencies:["dataTables"]}),$.Oda.Router.addRoute("liveContest",{path:"partials/liveContest.html",title:"liveContest.title",urls:["tournoi_live"],middleWares:["support","auth"]}),$.Oda.Router.addRoute("histoContest",{path:"partials/histoContest.html",title:"histoContest.title",urls:["tournoi_histo"],middleWares:["support","auth"]}),$.Oda.Router.addRoute("rulesContest",{path:"partials/rulesContest.html",title:"rulesContest.title",urls:["tournoi_rules"],middleWares:["support","auth"]}),$.Oda.Router.addRoute("chargesContest",{path:"partials/chargesContest.html",title:"chargesContest.title",urls:["chargesContest"],middleWares:["support","auth"],dependencies:["dataTables"]}),$.Oda.Router.startRooter(),this}catch(er){return $.Oda.Log.error("$.Oda.App.startApp : "+er.message),null}},Controler:{currentContest:{},Home:{start:function(){try{return $.Oda.App.Controler.Home.loadTournoisFini(),$.Oda.App.Controler.Home.loadTournoisEnCours(),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.Home.start : "+er.message),null}},loadTournoisFini:function(){try{var tabInput={auteur:"",fini:"oui"};return $.Oda.Interface.callRest($.Oda.Context.rest+"api/getTournois.php",{functionRetour:function(response){$("#divTabTournoisFini").html('<table cellpadding="0" cellspacing="0" border="0" class="display hover" id="tabTournoisFini" style="width: 100%"></table>');var objDataTable=$.Oda.Tooling.objDataTableFromJsonArray(response.data.resultat.data);$("#tabTournoisFini").DataTable({sPaginationType:"full_numbers",aaData:objDataTable.data,aaSorting:[[0,"desc"]],aoColumns:[{sTitle:"Id",sClass:"center"},{sTitle:"Titre",sClass:"center"},{sTitle:"Date Début",sClass:"center"},{sTitle:"Date Fin",sClass:"center"},{sTitle:"Auteur",sClass:"center"}],aoColumnDefs:[{mRender:function(data,type,row){return row[objDataTable.entete.id]},aTargets:[0]},{mRender:function(data,type,row){return"<a onclick=\"$.Oda.Router.navigateTo({'route':'tournoi_param',args:{'id':"+row[objDataTable.entete.id]+'}});">'+row[objDataTable.entete.titre]+"</a>"},aTargets:[1]},{mRender:function(data,type,row){return row[objDataTable.entete.dateDebut]},aTargets:[2]},{mRender:function(data,type,row){return row[objDataTable.entete.dateFin]},aTargets:[3]},{mRender:function(data,type,row){return row[objDataTable.entete.auteur]},aTargets:[4]}],fnDrawCallback:function(oSettings){$("#tabTournoisFini").removeClass("display").addClass("table table-striped table-bordered")}})}},tabInput),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.Home.loadTournoisFini : "+er.message),null}},loadTournoisEnCours:function(){try{var tabInput={auteur:"",fini:"non"};return $.Oda.Interface.callRest($.Oda.Context.rest+"api/getTournois.php",{functionRetour:function(response){$("#divTabTournoisEnCours").html('<table cellpadding="0" cellspacing="0" border="0" class="display hover" id="tabTournoisEnCours" style="width: 100%"></table>');var objDataTable=$.Oda.Tooling.objDataTableFromJsonArray(response.data.resultat.data);$("#tabTournoisEnCours").DataTable({sPaginationType:"full_numbers",aaData:objDataTable.data,aaSorting:[[0,"desc"]],aoColumns:[{sTitle:"Id",sClass:"center"},{sTitle:"Titre",sClass:"center"},{sTitle:"Date Création",sClass:"center"},{sTitle:"Date Début",sClass:"center"},{sTitle:"Auteur",sClass:"center"}],aoColumnDefs:[{mRender:function(data,type,row){return row[objDataTable.entete.id]},aTargets:[0]},{mRender:function(data,type,row){return"<a onclick=\"$.Oda.Router.navigateTo({'route':'tournoi_param',args:{'id':"+row[objDataTable.entete.id]+'}});">'+row[objDataTable.entete.titre]+"</a>"},aTargets:[1]},{mRender:function(data,type,row){return row[objDataTable.entete.dateCreation]},aTargets:[2]},{mRender:function(data,type,row){return row[objDataTable.entete.dateDebut]},aTargets:[3]},{mRender:function(data,type,row){return row[objDataTable.entete.auteur]},aTargets:[4]}],fnDrawCallback:function(oSettings){$("#tabTournoisEnCours").removeClass("display").addClass("table table-striped table-bordered")}})}},tabInput),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.Home.loadTournoisEnCours : "+er.message),null}}},NewContest:{start:function(p_params){try{return $.Oda.Scope.Gardian.add({id:"gardianCreateContest",listElt:["name"],function:function(params){$("#name").data("isOk")?($("#submit").removeClass("disabled"),$("#submit").removeAttr("disabled")):($("#submit").addClass("disabled"),$("#submit").attr("disabled",!0))}}),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.NewContest.start : "+er.message),null}},createContest:function(p_params){try{var p_titre=$("#name").val(),tabInput={code_user:$.Oda.Session.code_user,titre:p_titre};$.Oda.Interface.callRest($.Oda.Context.rest+"api/creerTournoi.php",{functionRetour:function(response){$.Oda.Display.Notification.success("Le tounoi n&deg;"+response.data.resultat+" a bien &eacute;t&eacute; cr&eacute;&eacute;")}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.NewContest.createContest : "+er.message),null}}},DetailsContest:{start:function(){try{if($.Oda.Router.current.args.hasOwnProperty("id"))$.Oda.Storage.set("currentContest-"+$.Oda.Session.code_user,{id:$.Oda.Router.current.args.id});else if(null===$.Oda.Storage.get("currentContest-"+$.Oda.Session.code_user))throw $.Oda.Router.navigateTo({route:"home",args:{}}),{message:"Id tournois unknow."};$.Oda.App.Controler.currentContest=$.Oda.Storage.get("currentContest-"+$.Oda.Session.code_user),$("#numContest").html("n&deg;"+$.Oda.App.Controler.currentContest.id);var tabInput={table:"tab_tournois",get:{champ:"titre",type:"PARAM_STR"},filtre:{champ:"id",valeur:$.Oda.App.Controler.currentContest.id,type:"PARAM_INT"}};$.Oda.Interface.callRest($.Oda.Context.rest+"vendor/happykiller/oda/resources/api/getter.php",{functionRetour:function(response){$("#name").val(response.data.resultat.champ)}},tabInput);return $.Oda.Scope.Gardian.add({id:"gardianUpdataParamContest",listElt:["name"],function:function(params){$("#name").data("isOk")?($("#submit-param").removeClass("disabled"),$("#submit-param").removeAttr("disabled")):($("#submit-param").addClass("disabled"),$("#submit-param").attr("disabled",!0))}}),$.Oda.App.Controler.DetailsContest.loadListParticipant(),$.Oda.App.Controler.DetailsContest.detailsTapis(),$.Oda.App.Controler.DetailsContest.detailsRound(),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.DetailsContest.start : "+er.message),null}},loadListParticipant:function(){try{var tabInput={id_tournoi:$.Oda.App.Controler.currentContest.id};return $.Oda.Interface.callRest($.Oda.Context.rest+"api/getParticipantsTournoi.php",{functionRetour:function(response){$("#divParticipants").html('<table cellpadding="0" cellspacing="0" border="0" class="display hover" id="tabParticipants" style="width: 100%"></table>');var objDataTable=$.Oda.Tooling.objDataTableFromJsonArray(response.data.resultat.data);$("#tabParticipants").DataTable({sPaginationType:"full_numbers",aaData:objDataTable.data,aaSorting:[[0,"desc"]],aoColumns:[{sTitle:"Nom",sClass:"dataTableColCenter"},{sTitle:"Prénom",sClass:"dataTableColCenter"},{sTitle:"Addon",sClass:"dataTableColCenter"},{sTitle:"Cave",sClass:"dataTableColCenter"},{sTitle:"Action"}],aoColumnDefs:[{mRender:function(data,type,row){return row[objDataTable.entete.nom]},aTargets:[0]},{mRender:function(data,type,row){return row[objDataTable.entete.prenom]},aTargets:[1]},{mRender:function(data,type,row){return row[objDataTable.entete.nb_addon]},aTargets:[2]},{mRender:function(data,type,row){return row[objDataTable.entete.nb_recave]},aTargets:[3]},{mRender:function(data,type,row){var strHtml="";return"0"!==row[objDataTable.entete.roundFin]&&(strHtml+='&nbsp;<button onclick="$.Oda.App.Controler.DetailsContest.backParticipant({id:'+row[objDataTable.entete.id]+'})" class="btn btn-warning btn-xs" title="revenir"><span class="glyphicon glyphicon-retweet" aria-hidden="true"></span></button>'),"0"!==row[objDataTable.entete.nb_addon]&&(strHtml+='&nbsp;<button onclick="$.Oda.App.Controler.DetailsContest.delAddonParticipant({id:'+row[objDataTable.entete.id_user]+'})" class="btn btn-warning btn-xs" title="retirer addon"><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></button>'),"0"!==row[objDataTable.entete.nb_recave]&&(strHtml+='&nbsp;<button onclick="$.Oda.App.Controler.DetailsContest.delCaveParticipant({id:'+row[objDataTable.entete.id_user]+'})" class="btn btn-warning btn-xs" title="retirer cave"><span class="glyphicon glyphicon-minus" aria-hidden="true"></span></button>'),strHtml+='&nbsp;<button onclick="$.Oda.App.Controler.DetailsContest.delParticipant({id:'+row[objDataTable.entete.id_user]+'})" class="btn btn-danger btn-xs" title="delete"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>'},aTargets:[4]}],fnDrawCallback:function(oSettings){$("#tabParticipants").removeClass("display").addClass("table table-striped table-bordered")}})}},tabInput),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.DetailsContest.loadListParticipant : "+er.message),null}},submitParam:function(p_params){try{var tabInput={table:"tab_tournois",set:{champ:"titre",valeur:$("#name").val(),type:"PARAM_STR"},filtre:{champ:"id",valeur:$.Oda.App.Controler.currentContest.id,type:"PARAM_INT"}};$.Oda.Interface.callRest($.Oda.Context.rest+"vendor/happykiller/oda/resources/api/setter.php",{functionRetour:function(response){$.Oda.Display.Notification.success("Mise &agrave; jour r&eacute;ussi.")}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.DetailsContest.submitParam : "+er.message),null}},reset:function(){try{var tabInput={action:"reinit",id_tournoi:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/actionDecompte.php",{functionRetour:function(response){$.Oda.Display.Notification.success("Remise à zéro r&eacute;ussi."),clearInterval($.Oda.App.Controler.LiveContest.timer)}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.DetailsContest.reset : "+er.message),null}},addParticipant:function(){try{return $.Oda.Display.Popup.open({label:$.Oda.I8n.get("detailsContest","addParticipant"),details:'<div id="divListUser"><oda-loading></oda-loading></div>',callback:function(){var tabInput={recherche:"",id_tournoi:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/getParticipants.php",{functionRetour:function(response){$("#divListUser").html('<table cellpadding="0" cellspacing="0" border="0" class="display hover" id="tabListUser" style="width: 100%"></table>');var objDataTable=$.Oda.Tooling.objDataTableFromJsonArray(response.data.resultat.data);$("#tabListUser").DataTable({sPaginationType:"full_numbers",aaData:objDataTable.data,aaSorting:[[0,"desc"]],aoColumns:[{sTitle:"Nom",sClass:"dataTableColCenter"},{sTitle:"Prénom",sClass:"dataTableColCenter"},{sTitle:"Action"}],aoColumnDefs:[{mRender:function(data,type,row){return row[objDataTable.entete.nom]},aTargets:[0]},{mRender:function(data,type,row){return row[objDataTable.entete.prenom]},aTargets:[1]},{mRender:function(data,type,row){return'<button onclick="$.Oda.App.Controler.DetailsContest.addParticipantSelected({id:'+row[objDataTable.entete.id]+'})" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>'},aTargets:[2]}],fnDrawCallback:function(oSettings){$("#tabListUser").removeClass("display").addClass("table table-striped table-bordered")}})}},tabInput)},name:"popListUser"}),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.DetailsContest.addParticipant : "+er.message),null}},addParticipantSelected:function(p_params){try{var tabInput={id_user:p_params.id,id_tournoi:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/addParticipant.php",{functionRetour:function(response){$.Oda.Display.Popup.close({name:"popListUser"}),$.Oda.App.Controler.DetailsContest.loadListParticipant()}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.DetailsContest.addParticipantSelected : "+er.message),null}},delParticipant:function(p_params){try{var tabInput={id_user:p_params.id,id_tournoi:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/delParticipant.php",{functionRetour:function(response){$.Oda.App.Controler.DetailsContest.loadListParticipant()}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.DetailsContest.delParticipant : "+er.message),null}},backParticipant:function(p_params){try{var tabInput={id_user:p_params.id,id_tournoi:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/inParticipant.php",{functionRetour:function(response){$.Oda.App.Controler.DetailsContest.loadListParticipant()}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.DetailsContest.backParticipant : "+er.message),null}},delAddonParticipant:function(p_params){try{var tabInput={id_user:p_params.id,id_tournoi:$.Oda.App.Controler.currentContest.id,type:"addon"};$.Oda.Interface.callRest($.Oda.Context.rest+"api/delNewTapisParticipant.php",{functionRetour:function(response){$.Oda.App.Controler.DetailsContest.loadListParticipant()}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.DetailsContest.delAddonParticipant : "+er.message),null}},delCaveParticipant:function(p_params){try{var tabInput={id_user:p_params.id,id_tournoi:$.Oda.App.Controler.currentContest.id,type:"recave"};$.Oda.Interface.callRest($.Oda.Context.rest+"api/delNewTapisParticipant.php",{functionRetour:function(response){$.Oda.App.Controler.DetailsContest.loadListParticipant()}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.DetailsContest.delCaveParticipant : "+er.message),null}},detailsTapis:function(p_params){try{var tabInput={id_tournois:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/getTapis.php",{functionRetour:function(response){var strBody="",sum=0;$.each(response.data.resultat.data,function(key,value){var total=parseInt(value.valeur_jeton)*parseInt(value.nb_jeton);sum+=total,strBody+="<tr><td>"+value.valeur_jeton+"</td><td>"+value.nb_jeton+"</td><td>"+total+"</td></tr>"});var strHtml=$.Oda.Display.TemplateHtml.create({template:"templateTapis",scope:{tbody:strBody,valueTotalTapis:sum,labelTotalTapis:$.Oda.I8n.getByString("detailsContest.labelTotalTapis")}});$("#divTapis").html(strHtml)}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.DetailsContest.detailsTapis : "+er.message),null}},detailsRound:function(p_params){try{var tabInput={id_tournoi:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/getRounds.php",{functionRetour:function(response){var strBody="";$.each(response.data.resultat.data,function(key,value){strBody+="<tr><td>"+value.temps+"</td><td>"+value.small_blind+"</td><td>"+value.big_blind+"</td><td>"+value.ante+"</td></tr>"});var strHtml=$.Oda.Display.TemplateHtml.create({template:"templateRound",scope:{tbody:strBody}});$("#divRound").html(strHtml)}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.DetailsContest.detailsRound : "+er.message),null}}},LiveContest:{etatTimer:"",decompte:0,timer:null,display:"small",start:function(p_params){try{if($.Oda.Router.current.args.hasOwnProperty("id"))$.Oda.Storage.set("currentContest-"+$.Oda.Session.code_user,{id:$.Oda.Router.current.args.id});else if(null===$.Oda.Storage.get("currentContest-"+$.Oda.Session.code_user))throw $.Oda.Router.navigateTo({route:"home",args:{}}),{message:"Id tournois unknow."};return $.Oda.App.Controler.currentContest=$.Oda.Storage.get("currentContest-"+$.Oda.Session.code_user),$.Oda.App.Controler.LiveContest.loadStats(),$.Oda.App.Controler.LiveContest.loadPlayers(),$.Oda.App.Controler.LiveContest.loadClockContest(),setInterval(function(){$.Oda.App.Controler.LiveContest.loadClock()},1e3),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.LiveContest.start : "+er.message),null}},loadPlayers:function(){try{var tabInput={id_tournoi:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/getParticipantsTournoi.php",{functionRetour:function(response){var dataRetour=response.data.resultat.data;for(var indice in dataRetour){var strDisable="",strBackGroudOut="oda-panel-in";"0"!==dataRetour[indice].roundFin&&(strDisable="disabled",strBackGroudOut="oda-panel-out");var strHtml=$.Oda.Display.TemplateHtml.create({template:"templatePlayer",scope:{disable:strDisable,name:dataRetour[indice].prenom.substring(0,10)+"."+dataRetour[indice].nom.substring(0,1),nbTapis:dataRetour[indice].nb_tapis,idTournois:$.Oda.App.Controler.currentContest.id,userId:dataRetour[indice].id_user,backgroudOut:strBackGroudOut}});$("#set"+(parseInt(indice)+1)).html(strHtml)}}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.LiveContest.loadPlayers : "+er.message),null}},addAddon:function(p_params){try{var tabInput={id_user:p_params.userId,id_tournoi:$.Oda.App.Controler.currentContest.id,type:"addon"};$.Oda.Interface.callRest($.Oda.Context.rest+"api/tapisParticipant.php",{functionRetour:function(response){$.Oda.App.Controler.LiveContest.loadPlayers(),$.Oda.App.Controler.LiveContest.loadStats()}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.LiveContest.addAddon : "+er.message),null}},addCave:function(p_params){try{var tabInput={id_user:p_params.userId,id_tournoi:$.Oda.App.Controler.currentContest.id,type:"recave"};$.Oda.Interface.callRest($.Oda.Context.rest+"api/tapisParticipant.php",{functionRetour:function(response){$.Oda.App.Controler.LiveContest.loadPlayers(),$.Oda.App.Controler.LiveContest.loadStats()}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.LiveContest.addCave : "+er.message),null}},out:function(p_params){try{var tabInput={id_user:p_params.userId,id_tournoi:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/outParticipant.php",{functionRetour:function(response){$.Oda.App.Controler.LiveContest.loadPlayers(),$.Oda.App.Controler.LiveContest.loadStats()}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.LiveContest.out : "+er.message),null}},loadStats:function(p_params){try{var tabInput={id_tournoi:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/getInfosLive.php",{functionRetour:function(response){var strDateDebut=response.data.strDateDebut,strDateFin=response.data.strDateFin,strTitre=response.data.strTitre,intNbJetonsTapis=0;intNbJetonsTapis=parseInt(response.data.strNbJetonsTapis);var intNbTapis=0;intNbTapis=parseInt(response.data.strNbTapis);var intNbParticpantsActif=0;intNbParticpantsActif=parseInt(response.data.strNbParticipant);var intTapisMoyen=0;intTapisMoyen=Math.round(intNbJetonsTapis*intNbTapis/intNbParticpantsActif);var intValeurTapis=0;intValeurTapis=parseInt(response.data.strValeurTapis);var int50=0;int50=Math.round(intValeurTapis*intNbTapis*.5);var int30=0;int30=Math.round(intValeurTapis*intNbTapis*.3);var int20=0;int20=Math.round(intValeurTapis*intNbTapis*.2);response.data.strDateDebut,$("#big").html("B: <b>"+response.data.strSmall_blind+"</b>"),$("#small").html("S: <b>"+response.data.strBig_blind+"</b>");var strAnte="Ante: <b>"+response.data.strAnte+"</b>";"0"===response.data.strAnte&&(strAnte=""),$("#ante").html(strAnte),$("#tm").html(intTapisMoyen),$("#nbTapis").html(intNbTapis),$("#50").html(int50+"&euro;"),$("#30").html(int30+"&euro;"),$("#20").html(int20+"&euro;"),$("#startDate").html(strDateDebut),$("#endDate").html(strDateFin),$("#nameContest").html(strTitre.substr(0,15))}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.Controler.LiveContest.loadStats : "+er.message),null}},loadClock:function(p_params){try{var strHtml=$.Oda.Date.getStrDateTime();return $("#date").html(strHtml),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.LiveContest.loadClock : "+er.message),null}},loadClockContest:function(p_params){try{var tabInput={id_tournoi:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/getInfosLive.php",{functionRetour:function(response){response.data.strSebutDecompte;var intDecompte=parseInt(response.data.strDecompte),intRestantSeconde=parseInt(response.data.strTempsRestantSeconde);switch($.Oda.App.Controler.LiveContest.etatTimer=response.data.strEtatDecompte,"encours"===$.Oda.App.Controler.LiveContest.etatTimer?$.Oda.App.Controler.LiveContest.decompte=intDecompte:$.Oda.App.Controler.LiveContest.decompte=intRestantSeconde,$.Oda.App.Controler.LiveContest.round=parseInt(response.data.strRoundEnCours),$("#round").html("N: <b>"+$.Oda.App.Controler.LiveContest.round+"</b>"),$("#roundTime").html("T: <b>"+$.Oda.Date.convertSecondsToTime($.Oda.App.Controler.LiveContest.decompte).substr(3)+"</b>"),$.Oda.App.Controler.LiveContest.etatTimer){case"init":$("#start").show(),$("#stop").hide(),$("#pause").hide();break;case"pause":$("#start").show(),$("#stop").show(),$("#pause").hide();break;case"stop":$("#start").hide(),$("#stop").hide(),$("#pause").hide();break;case"encours":$("#start").hide(),$("#stop").show(),$("#pause").show(),clearInterval($.Oda.App.Controler.LiveContest.timer),$.Oda.App.Controler.LiveContest.timer=setInterval(function(){$.Oda.App.Controler.LiveContest.loadDecompte()},1e3)}}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.LiveContest.loadClockContest : "+er.message),null}},actionDecompte:function(p_action){try{switch(p_action){case"start":tabInput={id_tournoi:$.Oda.App.Controler.currentContest.id,action:"start"},$.Oda.Interface.callRest($.Oda.Context.rest+"api/actionDecompte.php",{functionRetour:function(response){$.Oda.App.Controler.LiveContest.loadStats(),$.Oda.App.Controler.LiveContest.loadClockContest()}},tabInput);break;case"pause":tabInput={id_tournoi:$.Oda.App.Controler.currentContest.id,action:"pause"},$.Oda.Interface.callRest($.Oda.Context.rest+"api/actionDecompte.php",{functionRetour:function(response){clearInterval($.Oda.App.Controler.LiveContest.timer),$.Oda.App.Controler.LiveContest.loadStats(),$.Oda.App.Controler.LiveContest.loadClockContest()}},tabInput);break;case"stop":var tabInput={id_tournoi:$.Oda.App.Controler.currentContest.id,action:"stop"};$.Oda.Interface.callRest($.Oda.Context.rest+"api/actionDecompte.php",{functionRetour:function(response){clearInterval($.Oda.App.Controler.LiveContest.timer),$.Oda.App.Controler.LiveContest.loadStats(),$.Oda.App.Controler.LiveContest.loadClockContest()}},tabInput)}return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.LiveContest.actionDecompte : "+er.message),null}},loadDecompte:function(){try{if($.Oda.App.Controler.LiveContest.decompte-=1,$("#roundTime").html("T: <b>"+$.Oda.Date.convertSecondsToTime($.Oda.App.Controler.LiveContest.decompte).substr(3)+"</b>"),0===$.Oda.App.Controler.LiveContest.decompte){clearInterval($.Oda.App.Controler.LiveContest.timer);var tabInput={id_tournoi:$.Oda.App.Controler.currentContest.id,action:"upRound"};$.Oda.Interface.callRest($.Oda.Context.rest+"api/actionDecompte.php",{functionRetour:function(response){$.Oda.App.Controler.LiveContest.loadStats(),$.Oda.App.Controler.LiveContest.loadClockContest(),$.Oda.App.Controler.LiveContest.timer=setInterval(function(){$.Oda.App.Controler.LiveContest.loadDecompte()},1e3)}},tabInput)}return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.LiveContest.loadDecompte : "+er.message),null}},changeDisplay:function(){try{return"full"===$.Oda.App.Controler.LiveContest.display?($.Oda.App.Controler.LiveContest.display="small",$("#display").removeClass("glyphicon-resize-small"),$("#display").addClass("glyphicon-resize-full"),$("#title").show(),$("#menu-tabs").show(),$("nav").show()):($.Oda.App.Controler.LiveContest.display="full",$("#display").removeClass("glyphicon-resize-full"),$("#display").addClass("glyphicon-resize-small"),$("#title").hide(),$("#menu-tabs").hide(),$("nav").hide()),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.LiveContest.changeDisplay : "+er.message),null}}},HistoContest:{start:function(p_params){try{if($.Oda.Router.current.args.hasOwnProperty("id"))$.Oda.Storage.set("currentContest-"+$.Oda.Session.code_user,{id:$.Oda.Router.current.args.id});else if(null===$.Oda.Storage.get("currentContest-"+$.Oda.Session.code_user))throw $.Oda.Router.navigateTo({route:"home",args:{}}),{message:"Id tournois unknow."};$.Oda.App.Controler.currentContest=$.Oda.Storage.get("currentContest-"+$.Oda.Session.code_user);var tabInput={id_tournoi:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/getHisto.php",{functionRetour:function(response){for(var indice in response.data.resultat.data){var elt=response.data.resultat.data[indice],strHtml="<tr>";strHtml+="<td>"+elt.place+"</td><td>"+elt.nom+"</td><td>"+elt.prenom+"</td><td>"+elt.fin+"</td><td>"+elt.roundFin+"</td>",strHtml+="</tr>",$("#tabHisto tbody").append(strHtml)}}},tabInput);return this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.HistoContest.start : "+er.message),null}}},ChargesContest:{start:function(){try{if($.Oda.Router.current.args.hasOwnProperty("id"))$.Oda.Storage.set("currentContest-"+$.Oda.Session.code_user,{id:$.Oda.Router.current.args.id});else if(null===$.Oda.Storage.get("currentContest-"+$.Oda.Session.code_user))throw $.Oda.Router.navigateTo({route:"home",args:{}}),{message:"Id tournois unknow."};return $.Oda.App.Controler.currentContest=$.Oda.Storage.get("currentContest-"+$.Oda.Session.code_user),$.Oda.App.Controler.ChargesContest.displayUsers(),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.ChargesContest.start : "+er.message),null}},displayUsers:function(){try{var tabInput={idContest:$.Oda.App.Controler.currentContest.id};return $.Oda.Interface.callRest($.Oda.Context.rest+"api/getUsersForCharges.php",{functionRetour:function(response){var contestCharges=response.data.result.data,nbGrid=Math.ceil(contestCharges.length/4),listContent=[];contestCharges.totalExpenditure=0,$.each(contestCharges,function(index,contestCharge){var strPart="";strPart+='<a onclick="$.Oda.App.Controler.ChargesContest.editPart({ id : '+contestCharge.id+", value : "+contestCharge.part+", author : '"+contestCharge.prenom+"."+contestCharge.nom.substring(0,1)+'\' });"><span class="glyphicon glyphicon-pencil"></span></a>',strPart+=contestCharge.part;var strExpenditure="";if(contestCharge.totalExpenditure=0,$.each(contestCharge.expenditure,function(index,value){contestCharges.totalExpenditure+=parseFloat(value.expenditure),contestCharge.totalExpenditure+=parseFloat(value.expenditure),strExpenditure+='<a onclick="$.Oda.App.Controler.ChargesContest.editCharge({ id : '+value.id+", cmt : '"+value.cmt+"', value : "+value.expenditure+", type : 'expenditure', author : '"+contestCharge.prenom+"."+contestCharge.nom.substring(0,1)+'\' });"><span class="glyphicon glyphicon-pencil"></span></a>'+value.expenditure+"&euro; : "+value.cmt+"<br>"}),strExpenditure.length>0){str="";str+='<li oda-label="chargesContest.expenditure">chargesContest.expenditure"</li>',strExpenditure=str+=strExpenditure}var strProfit="";if(contestCharge.totalProfit=0,$.each(contestCharge.profit,function(index,value){contestCharge.totalProfit+=parseFloat(value.profit),strProfit+='<a onclick="$.Oda.App.Controler.ChargesContest.editCharge({ id : '+value.id+", cmt : '"+value.cmt+"', value : "+value.profit+", type : 'profit', author : '"+contestCharge.prenom+"."+contestCharge.nom.substring(0,1)+'\' });"><span class="glyphicon glyphicon-pencil"></span></a>'+value.profit+"&euro; : "+value.cmt+"<br>"}),strProfit.length>0){var str="";str+='<li oda-label="chargesContest.profit">chargesContest.profit"</li>',strProfit=str+=strProfit}var strLoose="";contestCharge.loose=5*parseInt(contestCharge.nbTapis),0!==contestCharge.loose&&(strLoose+=contestCharge.loose+"&euro;"),strLoose=strLoose.length>0?'<li oda-label="chargesContest.loose">chargesContest.loose"</li>'+strLoose:"";var strHtml=$.Oda.Display.TemplateHtml.create({template:"templatePostIt",scope:{part:strPart,expenditure:strExpenditure,profit:strProfit,balance:'<span id="blance-'+contestCharge.id+'"></span>&euro;',author:contestCharge.prenom+"."+contestCharge.nom.substring(0,1),id:contestCharge.id,loose:strLoose}});listContent.push(strHtml)});for(var contribution=$.Oda.Tooling.arrondir(contestCharges.totalExpenditure/contestCharges.length,1),strPostIts="",i=0;i<nbGrid;i++)strPostIts+=$.Oda.Display.TemplateHtml.create({template:"templateGrid",scope:{elt1:void 0!==listContent[4*i]?listContent[4*i]:"",elt2:void 0!==listContent[4*i+1]?listContent[4*i+1]:"",elt3:void 0!==listContent[4*i+2]?listContent[4*i+2]:"",elt4:void 0!==listContent[4*i+3]?listContent[4*i+3]:""}});$("#divPostIts").html(strPostIts),$.each(contestCharges,function(index,value){var balance=$.Oda.Tooling.arrondir(value.totalProfit-contribution*value.part-value.loose+value.totalExpenditure,1);balance>=0?$("#blance-"+value.id).html($.Oda.I8n.getByString("chargesContest.forPlayer")+balance):$("#blance-"+value.id).html($.Oda.I8n.getByString("chargesContest.forBank")+Math.abs(balance))})}},tabInput),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.ChargesContest.displayUsers : "+er.message),null}},showUsers:function(){try{return $.Oda.Display.Popup.open({label:$.Oda.I8n.get("detailsContest","addParticipant"),details:'<div id="divListUser"><oda-loading></oda-loading></div>',callback:function(){var tabInput={recherche:"",id_tournoi:$.Oda.App.Controler.currentContest.id};$.Oda.Interface.callRest($.Oda.Context.rest+"api/getParticipants.php",{functionRetour:function(response){$("#divListUser").html('<table cellpadding="0" cellspacing="0" border="0" class="display hover" id="tabListUser" style="width: 100%"></table>');var objDataTable=$.Oda.Tooling.objDataTableFromJsonArray(response.data.resultat.data);$("#tabListUser").DataTable({sPaginationType:"full_numbers",aaData:objDataTable.data,aaSorting:[[0,"desc"]],aoColumns:[{sTitle:"Nom",sClass:"dataTableColCenter"},{sTitle:"Prénom",sClass:"dataTableColCenter"},{sTitle:"Action"}],aoColumnDefs:[{mRender:function(data,type,row){return row[objDataTable.entete.nom]},aTargets:[0]},{mRender:function(data,type,row){return row[objDataTable.entete.prenom]},aTargets:[1]},{mRender:function(data,type,row){return'<button onclick="$.Oda.App.Controler.ChargesContest.addUser({id:'+row[objDataTable.entete.id]+'})" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>'},aTargets:[2]}],fnDrawCallback:function(oSettings){$("#tabListUser").removeClass("display").addClass("table table-striped table-bordered")}})}},tabInput)},name:"popListUser"}),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.ChargesContest.showUsers : "+er.message),null}},addUser:function(p_params){try{var tabInput={idUser:p_params.id,idContest:$.Oda.App.Controler.currentContest.id};return $.Oda.Interface.callRest($.Oda.Context.rest+"api/addUserForCharges.php",{functionRetour:function(response){$.Oda.Display.Popup.close({name:"popListUser"}),$.Oda.App.Controler.ChargesContest.displayUsers()}},tabInput),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.ChargesContest.addUser : "+er.message),null}},addCharges:function(p_params){try{var strHtml=$.Oda.Display.TemplateHtml.create({template:"templateFormAddCharges",scope:{}});return $.Oda.Display.Popup.open({name:"popAddCharges",label:$.Oda.I8n.get("chargesContest","addCharges")+" "+p_params.author,details:strHtml,footer:'<button type="button" oda-label="oda-main.bt-submit" oda-submit="submit" onclick="$.Oda.App.Controler.ChargesContest.submitCharges({id:'+p_params.id+'});" class="btn btn-primary disabled" disabled>Submit</button >',callback:function(){$.Oda.Scope.Gardian.add({id:"addCharges",listElt:["cmt","amount"],function:function(params){$("#cmt").data("isOk")&&$("#amount").data("isOk")?($("#submit").removeClass("disabled"),$("#submit").removeAttr("disabled")):($("#submit").addClass("disabled"),$("#submit").attr("disabled",!0))}})}}),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.ChargesContest.addCharges : "+er.message),null}},submitCharges:function(p_params){try{var tabInput={idContestCharges:p_params.id,type:$("input[name=optionsRadios]:checked").val(),cmt:$("#cmt").val(),amount:$("#amount").val()};return $.Oda.Interface.callRest($.Oda.Context.rest+"api/addCharges.php",{functionRetour:function(response){$.Oda.Display.Popup.close({name:"popAddCharges"}),$.Oda.App.Controler.ChargesContest.displayUsers()}},tabInput),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.ChargesContest.submitCharges : "+er.message),null}},del:function(p_params){try{var tabInput={idContestCharges:p_params.id};return $.Oda.Interface.callRest($.Oda.Context.rest+"api/delUserForCharges.php",{functionRetour:function(response){$.Oda.App.Controler.ChargesContest.displayUsers()}},tabInput),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.ChargesContest.del : "+er.message),null}},editPart:function(p_params){try{var strHtml=$.Oda.Display.TemplateHtml.create({template:"templateEditPart",scope:{value:p_params.value}});return $.Oda.Display.Popup.open({name:"popEditPart",label:$.Oda.I8n.get("chargesContest","part")+", "+p_params.author,details:strHtml,footer:'<button type="button" oda-label="oda-main.bt-submit" oda-submit="submit" onclick="$.Oda.App.Controler.ChargesContest.submitEditPart({id:'+p_params.id+'});" class="btn btn-primary disabled" disabled>Submit</button >',callback:function(){$.Oda.Scope.Gardian.add({id:"gEditPart",listElt:["newPart"],function:function(params){$("#newPart").data("isOk")?($("#submit").removeClass("disabled"),$("#submit").removeAttr("disabled")):($("#submit").addClass("disabled"),$("#submit").attr("disabled",!0))}})}}),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.ChargesContest.editPart : "+er.message),null}},submitEditPart:function(p_params){try{var tabInput={table:"tab_contest_charges",set:{champ:"part",valeur:$("#newPart").val(),type:"PARAM_DOUBLE"},filtre:{champ:"id",valeur:p_params.id,type:"PARAM_INT"}};return $.Oda.Interface.callRest($.Oda.Context.rest+"vendor/happykiller/oda/resources/api/setter.php",{functionRetour:function(response){$.Oda.Display.Popup.close({name:"popEditPart"}),$.Oda.App.Controler.ChargesContest.displayUsers()}},tabInput),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.ChargesContest.submitEditPart : "+er.message),null}},editCharge:function(p_params){try{var strHtml=$.Oda.Display.TemplateHtml.create({template:"templateEditCharge",scope:{id:p_params.id,author:p_params.author,cmt:p_params.cmt,type:p_params.type,amount:p_params.value}});return $.Oda.Display.Popup.open({name:"popEditCharge",label:$.Oda.I8n.get("chargesContest",p_params.type)+", "+p_params.author,details:strHtml,footer:'<button type="button" oda-label="oda-main.bt-delete" onclick="$.Oda.App.Controler.ChargesContest.submitDelCharge({id:'+p_params.id+'});" class="btn btn-danger">delete</button ><button type="button" oda-label="oda-main.bt-submit" oda-submit="submit" onclick="$.Oda.App.Controler.ChargesContest.submitEditCharge({id:'+p_params.id+", type : '"+p_params.type+'\'});" class="btn btn-primary disabled" disabled>Submit</button >',callback:function(){$.Oda.Scope.Gardian.add({id:"gEditCharge",listElt:["cmt","amount"],function:function(params){$("#cmt").data("isOk")&&$("#amount").data("isOk")?($("#submit").removeClass("disabled"),$("#submit").removeAttr("disabled")):($("#submit").addClass("disabled"),$("#submit").attr("disabled",!0))}})}}),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.ChargesContest.editCharge : "+er.message),null}},submitEditCharge:function(p_params){try{var tabInput={table:"tab_contest_charges_details",set:{champ:p_params.type,valeur:$("#amount").val(),type:"PARAM_DOUBLE"},filtre:{champ:"id",valeur:p_params.id,type:"PARAM_INT"}};return $.Oda.Interface.callRest($.Oda.Context.rest+"vendor/happykiller/oda/resources/api/setter.php",{functionRetour:function(response){var tabInput={table:"tab_contest_charges_details",set:{champ:"cmt",valeur:$("#cmt").val(),type:"PARAM_STR"},filtre:{champ:"id",valeur:p_params.id,type:"PARAM_INT"}};$.Oda.Interface.callRest($.Oda.Context.rest+"vendor/happykiller/oda/resources/api/setter.php",{functionRetour:function(response){$.Oda.Display.Popup.close({name:"popEditCharge"}),$.Oda.App.Controler.ChargesContest.displayUsers()}},tabInput)}},tabInput),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.ChargesContest.submitEditCharge : "+er.message),null}},submitDelCharge:function(p_params){try{var tabInput={idCharge:p_params.id};return $.Oda.Interface.callRest($.Oda.Context.rest+"api/delCharge.php",{functionRetour:function(response){$.Oda.Display.Popup.close({name:"popEditCharge"}),$.Oda.App.Controler.ChargesContest.displayUsers()}},tabInput),this}catch(er){return $.Oda.Log.error("$.Oda.App.Controler.ChargesContest.submitDelCharge : "+er.message),null}}}}},$.Oda.Event.addListener({name:"oda-fully-loaded",callback:function(e){$.Oda.App.startApp()}})}();